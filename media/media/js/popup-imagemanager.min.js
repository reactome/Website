(function($,doc){'use strict';window.ImageManager={initialize:function(){var o=this.getUriObject(window.self.location.href),q=this.getQueryObject(o.query);var options=Joomla.getOptions('mediamanager');this.author=options.author;this.base=options.base;this.asset=options.asset;this.editor=decodeURIComponent(q.e_name);this.fields={'url':doc.getElementById("f_url"),'alt':doc.getElementById("f_alt"),'align':doc.getElementById("f_align"),'title':doc.getElementById("f_title"),'caption':doc.getElementById("f_caption"),'c_class':doc.getElementById("f_caption_class")};this.folderlist=doc.getElementById('folderlist');this.frame=window.frames.imageframe;this.frameurl=this.frame.location.href;$('#imageframe').on('load',function(){ImageManager.onloadimageview()});$('#upbutton').off('click').on('click',function(){ImageManager.upFolder()})},onloadimageview:function(){var folder=this.getImageFolder(),$form=$('#uploadForm'),portString='',a,q;this.frameurl=this.frame.location.href;this.setFolder(folder);a=this.getUriObject($form.attr('action'));q=this.getQueryObject(a.query);q.folder=folder;a.query=$.param(q);if(typeof(a.port)!=='undefined'&&a.port!=80){portString=':'+a.port}$form.attr('action',a.scheme+'://'+a.domain+portString+a.path+'?'+a.query)},getImageFolder:function(){return this.getQueryObject(this.frame.location.search.substring(1)).folder.replace(/%2F/gi,"/")},onok:function(){var tag='',attr=[],figclass='',captionclass='',url=this.fields.url.value,alt=this.fields.alt.value,align=this.fields.align.value,title=this.fields.title.value,caption=this.fields.caption.value,c_class=this.fields.c_class.value;if(url){attr.push('alt="'+alt+'"');if(align&&!caption){attr.push('class="pull-'+align+'"')}if(title){attr.push('title="'+title+'"')}tag='<img src="'+url+'" '+attr.join(' ')+'/>';if(caption){if(align){figclass=' class="pull-'+align+'"'}if(c_class){captionclass=' class="'+c_class+'"'}tag='<figure'+figclass+'>'+tag+'<figcaption'+captionclass+'>'+caption+'</figcaption></figure>'}}if(window.Joomla&&Joomla.editors.instances.hasOwnProperty(this.editor)){Joomla.editors.instances[editor].replaceSelection(tag)}else{window.parent.jInsertEditorText(tag,this.editor)}return true},setFolder:function(folder,asset,author){folder=folder.replace(/%2F/gi,"/");for(var i=0,l=this.folderlist.length;i<l;i++){if(folder==this.folderlist.options[i].value){this.folderlist.selectedIndex=i;$(this.folderlist).trigger('liszt:updated').trigger('chosen:updated');break}}if(!!asset||!!author){this.setFrameUrl(folder,asset,author)}},upFolder:function(){var path=this.folderlist.value.split('/'),search;path.pop();search=path.join('/');this.setFolder(search);this.setFrameUrl(search,this.asset,this.author)},populateFields:function(file){$.each($('a.img-preview',$('#imageframe').contents()),function(i,v){if(v.href=="javascript:ImageManager.populateFields('"+file+"')"){$(v,$('#imageframe').contents()).addClass('selected')}else{$(v,$('#imageframe').contents()).removeClass('selected')}});$("#f_url").val(this.base+file)},showMessage:function(text){var $message=$('#message');$message.find('>:first-child').remove();$message.append(text);$('#messages').css('display','block')},refreshFrame:function(){this.frame.location.href=this.frameurl},setFrameUrl:function(folder,asset,author){var qs={option:'com_media',view:'imagesList',tmpl:'component',asset:asset,author:author};this.frameurl='index.php?'+$.param(qs)+'&folder='+folder;this.frame.location.href=this.frameurl},getQueryObject:function(q){var rs={};$.each((q||'').split(/[&;]/),function(key,val){var keys=val.split('=');rs[keys[0]]=keys.length==2?keys[1]:null});return rs},getUriObject:function(u){var bitsAssociate={},bits=u.match(/^(?:([^:\/?#.]+):)?(?:\/\/)?(([^:\/?#]*)(?::(\d*))?)((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[\?#]|$)))*\/?)?([^?#\/]*))?(?:\?([^#]*))?(?:#(.*))?/);$.each(['uri','scheme','authority','domain','port','path','directory','file','query','fragment'],function(key,index){bitsAssociate[index]=(!!bits&&!!bits[key])?bits[key]:''});return bitsAssociate}};$(function(){window.ImageManager.initialize()})}(jQuery,document));